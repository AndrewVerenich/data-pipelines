# ‚ö° Flink User Behaviour Analytics Pipeline

**–°—Ö–µ–º–∞:**  
User Behaviour Emulator ‚Üí Gateway WebSocket ‚Üí Kafka ‚Üí Flink (stream processing) ‚Üí Kafka ‚Üí ClickHouse ‚Üí Grafana (BI 
dashboards)

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Apache Kafka** ‚Äî –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Å–æ–±—ã—Ç–∏–π
- **Apache Flink** ‚Äî –ø–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- **ClickHouse** ‚Äî –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
- **Grafana** ‚Äî BI‚Äë–¥–∞—à–±–æ—Ä–¥—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- **Zookeeper** ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è Kafka –±—Ä–æ–∫–µ—Ä–æ–≤
- **Kafka UI (Redpanda Console)** ‚Äî —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–æ–ø–∏–∫–æ–≤
- **Gateway WebSocket** ‚Äî —à–ª—é–∑ –¥–ª—è –ø—Ä–∏—ë–º–∞ —Å–æ–±—ã—Ç–∏–π –æ—Ç —ç–º—É–ª—è—Ç–æ—Ä–∞
- **User Behaviour Emulator** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π

---

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Docker** 20.10+
- **Docker Compose** 2.0+
- **JDK 17+** (–¥–ª—è —Å–±–æ—Ä–∫–∏ Flink‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)
- **Gradle/Maven** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π wrapper)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —Å–æ–±–µ—Ä–∏—Ç–µ Flink‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
git clone <repository-url>
cd flink-pipeline
./gradlew clean build
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:
```bash
docker-compose up -d
```
3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
docker-compose stop

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ volumes)
docker-compose down

# –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞—è volumes (—É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ)
docker-compose down -v
```

## üåê URL —Å–µ—Ä–≤–∏—Å–æ–≤

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞, —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –∞–¥—Ä–µ—Å–∞–º:

| –°–µ—Ä–≤–∏—Å                | URL                          | Credentials       | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|-----------------------|------------------------------|------------------|-----------------------------------|
| **Kafka UI**          | http://localhost:8088        | -                | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Kafka topics           |
| **Flink Dashboard**   | http://localhost:8081        | -                | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Flink jobs             |
| **Grafana**           | http://localhost:3000        | admin / admin    | BI‚Äë–¥–∞—à–±–æ—Ä–¥—ã                       |
| **ClickHouse HTTP**   | http://localhost:8123        | admin / admin123 | –•—Ä–∞–Ω–∏–ª–∏—â–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö    |
| **ClickHouse TCP**    | localhost:9000               | admin / admin123 | TCP‚Äë–¥–æ—Å—Ç—É–ø –∫ ClickHouse           |
| **Gateway WebSocket** | ws://localhost:8080/ws/events| -                | –ü—Ä–∏—ë–º —Å–æ–±—ã—Ç–∏–π –æ—Ç —ç–º—É–ª—è—Ç–æ—Ä–∞        |

Flink job
![Job](docs/flink.jpg)
---

## üìä Grafana Dashboard

–ú–µ—Ç—Ä–∏–∫–∏:
- **Events per Type** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
- **Page Views** ‚Äî –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
- **Unique Users per Page** ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- **Conversion Rate** ‚Äî –∫–æ–Ω–≤–µ—Ä—Å–∏—è (view ‚Üí purchase)
- **Session Stats** ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –≤ —Å–µ—Å—Å–∏–∏
- **Funnel Stats** ‚Äî –≤–æ—Ä–æ–Ω–∫–∞ (view ‚Üí click ‚Üí purchase)
- **Activity Heatmap** ‚Äî –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º —Å—É—Ç–æ–∫
- **Retention** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ—Å—è vs –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  ![–î–∞—à–±–æ—Ä–¥](docs/metrics.jpg)
---

## üèóÔ∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **User Behaviour Emulator** —Å–∏–º—É–ª–∏—Ä—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ WebSocket
- **Gateway WebSocket** - —à–ª—é–∑ –±—ç–∫—ç–Ω–¥–∞, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ –≤–µ—Å–æ–∫–µ—Ç–∞ –∏ –ø—É–±–ª–∏–∫—É–µ—Ç –∏—Ö –≤ Kafka
- **Apache Flink** –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Kafka
- **Grafana** –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ ClickHouse –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
- **Docker Compose** —É–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–æ–º –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤